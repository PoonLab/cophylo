#Figure 1
R
library('kernlab')
setwd('/home/marianoavino/Desktop/Coevolution/kUgeneral')
m <- read.csv('kUgeneral.csv', header=F, row.names=1)
m1 <- as.matrix(m[,4:39])
km <- as.kernelMatrix(as.matrix(m1))
kp <- kpca(km)
eig(kp) / sum(eig(kp))
plot(rotated(kp), col=(rainbow(2, v=0.8, alpha=0.5)[m$V3]), cex=1.8, pch=c(16,17)[m$V4], xlab='1st principal component', ylab='2nd principal component', cex.lab=1.2, main="")
arrows(1.67293432,0.49707664, -1.74064841,0.56594978,length=0)
arrows(-0.58154352,0.2675036, -0.03083918,0.35049616,length=0)
arrows(-1.35137908,-0.01964648, -1.33928223,0.58599312,length=0)
arrows(-0.66116896,-1.45550015, -0.49407892,-2.02572709,length=0)
arrows(2.32269969,0.57800922, 2.27908574,-0.08308743,length=0)
arrows(-1.29032551,0.5136863, 0.52819849,0.53309431,length=0)
arrows(-0.34562907,-0.81074566, -0.65943773,-1.85093988,length=0)
arrows(-1.67724325,0.33061813, -2.30397687,0.41437632,length=0)
arrows(0.01352481,0.15357856, -0.12274984,-0.56948255,length=0)
arrows(-3.20327918,0.27875119, 2.42196233,0.09256549,length=0)
arrows(-0.41535254,0.13378274, -3.01457914,0.29607081,length=0)
arrows(-1.95673496,0.01149768, -0.84771361,0.51135405,length=0)
arrows(2.38342947,0.26048135, 2.3686219,0.60501541,length=0)
arrows(1.81169161,-2.80157999, 1.34572019,0.07412895,length=0)
arrows(1.49261528,0.5597438, 1.486601,0.98881483,length=0)
arrows(-0.36903701,0.29207771, -0.26587612,0.72319974,length=0)
arrows(-0.69669524,-0.86314656, 1.23204257,0.41086029,length=0)
arrows(2.53856211,0.13050438, -0.53011913,0.32062523,length=0)
text(rotated(kp), label=row.names(m), cex=0.6, pos=1, offset=0.3)
legend("bottomright",legend=c('Host','Pathogen'), pch=c(16,17), pt.cex=2,cex=1,bty='n')

#Figure 2
library('kernlab')
setwd('/home/marianoavino/Desktop/Coevolution/19virusfamilies/species_jumping_project-master/Virus_family_trees/Newick')
par(mfrow=c(1,3))
m <- read.csv('19virusfamilieswithoutlabelswithplantsmod.csv', header=F, row.names=1)
m1 <- as.matrix(m[,2:20])
km <- as.kernelMatrix(as.matrix(m1))
kp <- kpca(km)
eig(kp) / sum(eig(kp))
plot(rotated(kp), col=(rainbow(2, v=0.8, alpha=0.5)[m$V2]), cex=1.8, pch=c(19,15)[m$V2], xlab='1st principal component', ylab='2nd principal component', cex.lab=1.2, main="a")
text(rotated(kp), label=row.names(m), cex=0.7, pos=3, offset=0.3)
m <- read.csv('19virusfamilieswithlabelswithplantsdecayFactor0.2gaussFactor2sigma05mod.csv', header=F, row.names=1)
m1 <- as.matrix(m[,2:20])
km <- as.kernelMatrix(as.matrix(m1))
kp <- kpca(km)
plot(rotated(kp), col=(rainbow(2, v=0.8, alpha=0.5)[m$V2]), cex=1.8, pch=c(19,15)[m$V2], xlab='1st principal component', ylab='2nd principal component', cex.lab=1.2, main="b")
text(rotated(kp), label=row.names(m), cex=0.7, pos=3, offset=0.3)
m <- read.csv('19virusfamilieswithlabelswithplantsdecayFactor0.2gaussFactor2sigma0mod.csv', header=F, row.names=1)
m1 <- as.matrix(m[,2:20])
km <- as.kernelMatrix(as.matrix(m1))
kp <- kpca(km)
plot(rotated(kp), col=(rainbow(2, v=0.8, alpha=0.5)[m$V2]), cex=1.8, pch=c(19,15)[m$V2], xlab='1st principal component', ylab='2nd principal component', cex.lab=1.2, main="c")
text(rotated(kp), label=row.names(m), cex=0.7, pos=3, offset=0.3)

#Figure 3
library('kernlab')
setwd('/home/marianoavino/Desktop/Coevolution/19virusfamilies/species_jumping_project-master/Virus_family_trees/Newick')
par(mfrow=c(1,3))
m <- read.csv('19virusfamilieswithlabelswithoutplantsdecayFactor0.2gaussFactor2mod.csv', header=F, row.names=1)
m1 <- as.matrix(m[,2:19])
km <- as.kernelMatrix(as.matrix(m1))
kp <- kpca(km)
plot(rotated(kp), col=(rainbow(2, v=0.8, alpha=0.5)[m$V2]), cex=1.8, pch=c(19,15)[m$V2], xlab='1st principal component', ylab='2nd principal component', cex.lab=1.2, main="a")
text(rotated(kp), label=row.names(m), cex=0.7, pos=3, offset=0.3)
m <- read.csv('19virusfamilieswithlabelswithoutplantsdecayFactor0.2gaussFactor0.5mod.csv', header=F, row.names=1)
m1 <- as.matrix(m[,2:19])
km <- as.kernelMatrix(as.matrix(m1))
kp <- kpca(km)
plot(rotated(kp), col=(rainbow(2, v=0.8, alpha=0.5)[m$V2]), cex=1.8, pch=c(19,15)[m$V2], xlab='1st principal component', ylab='2nd principal component', cex.lab=1.2, main="b")
text(rotated(kp), label=row.names(m), cex=0.7, pos=3, offset=0.3)
m <- read.csv('19virusfamilieswithlabelswithoutplantsdecayFactor0.2gaussFactor2sigma0mod.csv', header=F, row.names=1)
m1 <- as.matrix(m[,2:19])
km <- as.kernelMatrix(as.matrix(m1))
kp <- kpca(km)
plot(rotated(kp), col=(rainbow(2, v=0.8, alpha=0.5)[m$V2]), cex=1.8, pch=c(19,15)[m$V2], xlab='1st principal component', ylab='2nd principal component', cex.lab=1.2, main="C")
text(rotated(kp), label=row.names(m), cex=0.7, pos=3, offset=0.3)

#Figure 4
setwd('/home/marianoavino/Desktop/Coevolution/Mammals-virus/PruningApproach/decayFactor0.2gaussFactor2Midpointtree')
library("kernlab", lib.loc="~/R/x86_64-pc-linux-gnu-library/3.2")
par(mfrow=c(1,2))
m <- read.csv('PruningOutgroupmidpointtree.csv', header=F, row.names=1)
m1 <- as.matrix(m[,4:41])
km <- as.kernelMatrix(as.matrix(m1))
kp <- kpca(km)
eig(kp) / sum(eig(kp))
plot(rotated(kp), col=(rainbow(2, v=0.8, alpha=0.5)[m$V3]), cex=1.8, pch=c(16,17)[m$V4], xlab='1st principal component', ylab='2nd principal component', cex.lab=1.2, main="")
text(rotated(kp), label=row.names(m), cex=0.6, pos=1, offset=0.3)
arrows(2.019781195,0.178678011,0.7866806,-1.32511831,length=0)
arrows(0.43227247,0.324543497,-1.234696958,0.424404183,length=0)
arrows(1.5599124,2.419102605,-0.437039603,0.892329585,length=0)
arrows(2.208940779,0.159944534,-2.336593081,0.017426068,length=0)
arrows(1.148661862,0.813102006,-2.495362562,0.352393114,length=0)
arrows(0.518067033,-0.598928628,-2.263649855,-1.852131411,length=0)
arrows(1.389366077,-1.717390492,0.557261147,-0.099808197,length=0)
arrows(-1.056203149,-1.601413381,-3.448215013,0.863251236,length=0)
arrows(1.357952222,-0.898278936,2.07195028,-1.318524457,length=0)
arrows(1.868160775,0.552472365,-1.710579243,-1.004708449,length=0)
arrows(1.75398008,1.046695519,-0.913392495,0.09125463,length=0)
arrows(1.75398008,1.046695519,0.200125107,-1.362946069,length=0)
arrows(1.176328865,1.060860211,0.009351812,-0.329388272,length=0)
arrows(3.211175347,0.004074051,-0.926452283,0.953297388,length=0)
arrows(0.582331356,-0.124255464,-2.164851977,1.463439408,length=0)
arrows(0.429695382,1.281753082,-1.795800733,0.300570819,length=0)
arrows(0.713359976,-0.413385806,-0.4854832,-2.061446102,length=0)
arrows(0.511555904,-0.271364612,-1.420498479,0.963127702,length=0)
arrows(0.36853834,-0.512255161,-3.94061046,0.281928217,length=0)
legend("topleft",legend=c('Host','Virus'), pch=c(16,17), pt.cex=2,cex=1,bty='n')
m <- read.csv('PruningOutgroupmidpointtreesigma0.csv', header=F, row.names=1)
m1 <- as.matrix(m[,4:41])
km <- as.kernelMatrix(as.matrix(m1))
kp <- kpca(km)
eig(kp) / sum(eig(kp))
plot(rotated(kp), col=(rainbow(2, v=0.8, alpha=0.5)[m$V3]), cex=1.8, pch=c(16,17)[m$V4], xlab='1st principal component', ylab='2nd principal component', cex.lab=1.2, main="")
text(rotated(kp), label=row.names(m), cex=0.6, pos=1, offset=0.3)
arrows(1.25539257,-1.55780028,0.7916768,-0.48341399,length=0)
arrows(-0.74850331,0.42914732,-1.67480501,2.25613687,length=0)
arrows(1.38222169,-1.64085549,1.39884159,-0.06927178,length=0)
arrows(-1.8219006,-0.15028689,-1.94644061,1.15137236,length=0)
arrows(0.80719723,0.31257261,1.89463019,1.03374031,length=0)
arrows(-3.53444232,-1.85091539,-3.42557183,-1.44179782,length=0)
arrows(-1.43332247,-0.28736728,1.72754098,0.10531758,length=0)
arrows(-1.37013232,1.60181172,-1.55670581,1.52531783,length=0)
arrows(1.59026978,0.92661944,1.32374315,0.95305973,length=0)
arrows(1.03376234,-0.20506895,0.4881895,0.71848067,length=0)
arrows(-0.27360906,-4.2983023,1.48030028,-0.20458272,length=0)
arrows(1.00060224,0.40319618,2.54817113,0.38097715,length=0)
arrows(-1.53326548,1.34124147,-1.53326548,1.34124147,length=0)
arrows(1.22908843,-0.06273605,0.55661017,0.20655741,length=0)
arrows(0.16794474,-0.99201196,-1.2982071,1.49993375,length=0)
arrows(-1.36507648,-1.66487993,2.73911555,0.10069072,length=0)
arrows(-1.27066349,-0.24245418,-1.90821321,1.07296312,length=0)
arrows(1.15223058,1.28233822,0.08839839,1.44269162,length=0)
arrows(-1.53326548,1.34124147,-1.53326548,1.34124147,length=0)
legend("bottomleft",legend=c('Host','Virus'), pch=c(16,17), pt.cex=2,cex=1,bty='n')

#Figure 5
setwd("/home/marianoavino/Desktop/Coevolution/Coalescent/Coevolution/Scripts-or-command-line-tricks/Hepadnaviridae/Justshape")
par(mfrow=c(1,4))
df <- read.csv(file="Results.csv", header=TRUE, sep=",")
boxplot(df, names=c("", "","","","","","","","","","","","","",""),col=rainbow(15, s=0.8),xlab="Migration rate (LogM)",ylab="Kernel", main = "a")
setwd("/home/marianoavino/Desktop/Coalescent/Coevolution/Scripts-or-command-line-tricks/Hepadnaviridae/Labelson/1_x_1")
df <- read.csv(file="Resultssigma05.csv", header=TRUE, sep=",")
boxplot(df, names=c("", "","","","","","","","","","","","","",""),col=rainbow(15, s=0.8),xlab="Migration rate (LogM)",ylab="Kernel", main = "b")
setwd("/home/marianoavino/Desktop/Coalescent/Coevolution/Scripts-or-command-line-tricks/Hepadnaviridae/Labelson/1_x_1/")
df <- read.csv(file="Resultssigma0.csv", header=TRUE, sep=",")
boxplot(df, names=c("", "","","","","","","","","","","","","",""),col=rainbow(15, s=0.8),xlab="Migration rate (LogM)",ylab="Kernel", main = "c")
setwd("/home/marianoavino/Desktop/Coalescent/Coevolution/Scripts-or-command-line-tricks/Hepadnaviridae/nPH85/1_x_1/")
df <- read.csv(file="ResultsnPH85.csv", header=TRUE, sep=",")
boxplot(df, names=c("", "","","","","","","","","","","","","",""),col=rainbow(15, s=0.8),xlab="Migration rate (LogM)",ylab="nPH85", main = "d")

#Figure 7
setwd("/home/marianoavino/Desktop/Coevolution/Coalescent/Coevolution/Scripts-or-command-line-tricks/Hepadnaviridae/Labelson/0000001_x_0/")
par(mfrow=c(1,4))
setwd("/home/marianoavino/Desktop/Coalescent/Coevolution/Scripts-or-command-line-tricks/Hepadnaviridae/Labelson/0000001_x_0/")
df <- read.csv(file="Results.csv", header=TRUE, sep=",")
boxplot(df, names=c("", "","","","","","","","","","","","",""),col=rainbow(14, s=0.8),xlab="Migration rate (LogM)",ylab="Kernel", main = "a")
setwd("/home/marianoavino/Desktop/Coalescent/Coevolution/Scripts-or-command-line-tricks/Hepadnaviridae/Labelson/0000001_x_0/")
df <- read.csv(file="Resultssigma05.csv", header=TRUE, sep=",")
boxplot(df, names=c("", "","","","","","","","","","","","",""),col=rainbow(14, s=0.8),xlab="Migration rate (LogM)",ylab="Kernel", main = "b")
df <- read.csv(file="Resultssigma0.csv", header=TRUE, sep=",")
boxplot(df, names=c("", "","","","","","","","","","","","",""),col=rainbow(14, s=0.8),xlab="Migration rate (LogM)",ylab="Kernel", main = "c")
setwd("/home/marianoavino/Desktop/Coalescent/Coevolution/Scripts-or-command-line-tricks/Hepadnaviridae/nPH85/0000001_x_0/")
df <- read.csv(file="Results.csv", header=TRUE, sep=",")
boxplot(df, names=c("", "","","","","","","","","","","","",""),col=rainbow(14, s=0.8),xlab="Migration rate (LogM)",ylab="nPH85", main = "d")

#Figure 8
par(mfrow=c(1,4))
setwd("/home/marianoavino/Desktop/Coevolution/Coalescent/Coevolution/Scripts-or-command-line-tricks/Hepadnaviridae/Labelson/x_0_0/")
df <- read.csv(file="Results.csv", header=TRUE, sep=",")
boxplot(df, names=c("","","","","","","","","","","","","",""),col=rainbow(14, s=0.8),xlab="Duplication rate (LogL)",ylab="Kernel", main = "a")
df <- read.csv(file="Resultssigma05.csv", header=TRUE, sep=",")
boxplot(df, names=c("","","","","","","","","","","","","",""),col=rainbow(14, s=0.8),xlab="Duplication rate (LogL)",ylab="Kernel", main = "b")
df <- read.csv(file="Resultssigma0.csv", header=TRUE, sep=",")
boxplot(df, names=c("","","","","","","","","","","","","",""),col=rainbow(14, s=0.8),xlab="Duplication rate (LogL)",ylab="Kernel", main = "c")
setwd("/home/marianoavino/Desktop/Coalescent/Coevolution/Scripts-or-command-line-tricks/Hepadnaviridae/nPH85/x_0_0/")
df <- read.csv(file="Results.csv", header=TRUE, sep=",")
boxplot(df, names=c("","","","","","","","","","","","","",""),col=rainbow(14, s=0.8),xlab="Duplication rate (LogL)",ylab="nPH85", main = "d")

#Figure 10
par(mfrow=c(1,4))
setwd("/home/marianoavino/Desktop/Coevolution/Coalescent/Coevolution/Scripts-or-command-line-tricks/Hepadnaviridae/Labelson/0000001_0_x/")
df <- read.csv(file="Results.csv", header=TRUE, sep=",")
boxplot(df, names=c("","","","","","","","","","","",""),col=rainbow(12, s=0.8),xlab="Co-speciation rate (LogP)",ylab="Kernel", main = "a")
df <- read.csv(file="Resultssigma05.csv", header=TRUE, sep=",")
boxplot(df, names=c("","","","","","","","","","","",""),col=rainbow(12, s=0.8),xlab="Co-speciation rate (LogP)",ylab="Kernel", main = "b")
df <- read.csv(file="Resultssigma0.csv", header=TRUE, sep=",")
boxplot(df, names=c("","","","","","","","","","","",""),col=rainbow(12, s=0.8),xlab="Co-speciation rate (LogP)",ylab="Kernel", main = "c")
setwd("/home/marianoavino/Desktop/Coalescent/Coevolution/Scripts-or-command-line-tricks/Hepadnaviridae/nPH85/0000001_0_x/")
df <- read.csv(file="Results.csv", header=TRUE, sep=",")
boxplot(df, names=c("","","","","","","","","","","",""),col=rainbow(12, s=0.8),xlab="Co-speciation rate (LogP)",ylab="nPH85", main = "d")

#Figure 11
library('kernlab')
par(mfrow=c(1,2))
setwd('/home/marianoavino/Desktop/Coevolution/Coalescent/Coevolution/Scripts-or-command-line-tricks/Hepadnaviridae/Labelson/Total')
m <- read.csv('Total.csv', header=F, row.names=1)
m1 <- as.matrix(m[,2:81])
km <- as.kernelMatrix(as.matrix(m1))
kp <- kpca(km)
eig(kp) / sum(eig(kp))
plot(rotated(kp), col=(rainbow(8, v=0.8, alpha=0.5)[m$V2]), cex=1.5, pch=c(0,1,2,3,4,5,6,7,8)[m$V2], xlab='1st principal component', ylab='2nd principal component', cex.lab=1.2, main="a")
legend("bottomleft", legend=c("M=0","M=0.00055","M=0.004375","M=1","L=0.000001","L=0.001","L=0.04","L=1"), pch=c(0,1,2,3,4,5,6,7,8), pt.cex=1,cex=0.5,bty='n',col=(rainbow(8, v=0.8, alpha=0.5)))
m <- read.csv('Totalsigma0.csv', header=F, row.names=1)
m1 <- as.matrix(m[,2:81])
km <- as.kernelMatrix(as.matrix(m1))
kp <- kpca(km)
eig(kp) / sum(eig(kp))
plot(rotated(kp), col=(rainbow(8, v=0.8, alpha=0.5)[m$V2]), cex=1.5, pch=c(0,1,2,3,4,5,6,7,8)[m$V2], xlab='1st principal component', ylab='2nd principal component', cex.lab=1.2, main="b")
legend("bottomleft", legend=c("M=0","M=0.00055","M=0.004375","M=1","L=0.000001","L=0.001","L=0.04","L=1"), pch=c(0,1,2,3,4,5,6,7,8), pt.cex=1,cex=0.5,bty='n',col=(rainbow(8, v=0.8, alpha=0.5)))

#Figure 12
library('kernlab')
par(mfrow=c(1,2))
setwd('/home/marianoavino/Desktop/Coevolution/Coalescent/Coevolution/Scripts-or-command-line-tricks/Hepadnaviridae/Labelson/Total')
m <- read.csv('Totalnotnormalized.csv', header=F, row.names=1)
m1 <- as.matrix(m[,2:81])
km <- as.kernelMatrix(as.matrix(m1))
kp <- kpca(km)
eig(kp) / sum(eig(kp))
plot(rotated(kp), col=(rainbow(8, v=0.8, alpha=0.5)[m$V2]), cex=1.5, pch=c(0,1,2,3,4,5,6,7,8)[m$V2], xlab='1st principal component', ylab='2nd principal component', cex.lab=1.2, main="a")
legend("topright", legend=c("M=0","M=0.00055","M=0.004375","M=1","L=0.000001","L=0.001","L=0.04","L=1"), pch=c(0,1,2,3,4,5,6,7,8), pt.cex=1,cex=0.5,bty='n',col=(rainbow(8, v=0.8, alpha=0.5)))
m <- read.csv('Totalsigma0notnormalized.csv', header=F, row.names=1)
m1 <- as.matrix(m[,2:81])
km <- as.kernelMatrix(as.matrix(m1))
kp <- kpca(km)
eig(kp) / sum(eig(kp))
plot(rotated(kp), col=(rainbow(8, v=0.8, alpha=0.5)[m$V2]), cex=1.5, pch=c(0,1,2,3,4,5,6,7,8)[m$V2], xlab='1st principal component', ylab='2nd principal component', cex.lab=1.2, main="b")
legend("topright", legend=c("M=0","M=0.00055","M=0.004375","M=1","L=0.000001","L=0.001","L=0.04","L=1"), pch=c(0,1,2,3,4,5,6,7,8), pt.cex=1,cex=0.5,bty='n',col=(rainbow(8, v=0.8, alpha=0.5)))

#Figure 13 (hypotetical number)
library('ggplot2')
setwd('/home/marianoavino/Desktop/Coevolution/DistanceMetricTotalAnalysis')
df <- read.csv('TotalbutKernelfinal.csv', header=T)
attach(df)
ggplot(df, aes(x = Metric, y = Percentile)) +
    geom_point(size = 1.5, aes(colour = Codivergence)) +
    labs(x = "\n Metric", y = "Percentile \n ", 
         title = "", fill = "Co-divergenge grade") + 
    theme(plot.title = element_text(hjust = 0.5), 
          axis.title.x = element_text(face="bold", colour="darkgreen", size = 12),
          axis.title.y = element_text(face="bold", colour="darkgreen", size = 12),
          legend.title = element_text(hjust = 0.5, face="bold", size = 10))
